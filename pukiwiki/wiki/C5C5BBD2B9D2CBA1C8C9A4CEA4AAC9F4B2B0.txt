#set_tags(飛行ロボコン,飛行機,マイコン)
*電気・プログラミングのお部屋です [#i7cb4460]

・プログラミングやらマイコンやらについて自由に書き込んでください。~
何度も言うようですが「電子航法班、随時募集中！！！！！！！」ですよ~
ごえかだーまんにいつでも声かけてくれていいのよ~
**ここから下にお願いします [#ae1388ac]

~
**とりけんマイコンボード計画　ごえ編 [#ae1388ac]
自動操縦に積むマイコン、センサー、ピンを１枚のオリジナル基板にまとめようって計画です~
まだ計画段階だけど、これができれば全班で共有の自動操縦が作れる、はず~
（６月２３日現在のパーツ計画だよ）~
- メインマイコン-----ＳＴＭ３２Ｆ４０７ＶＧＴ６(１３２１円）~
STM32F4Descoveryに乗ってるマイコン~
書き込みはDescoveryに乗ってるST-Link経由で~
浮動小数点が使える　ＡＤ変換を後ろで勝手にやってくれるよ~
~
- ジャイロセンサー----A3G4250DTR(１７７４円）~
STmicroの16bit3軸ジャイロ　温度データもくれるよ~
温度データは加速度ジャイロ共に補正に使えるからあるととっても便利、かな？~
~
-加速度センサー-----ADXL345(７３９円）~
アナログデバイセス社の10bit?3軸加速度~
なんと3400Hzでアウトプットできるみたいよ~
秋月にモジュール(435円）もあるからとりあえず購入しやすい~
あとMMA8451QR1（１８８円　フリースケール社）も捨てがたい~
~
-コンパスセンサー-----HMC6352(1852円）~
ハネウェル社の角度出力の２軸コンパス~
方位が磁気強度じゃなくて方位で帰ってくるから使いやすい（でも磁気強度から逆三角関数で算出する手順なんてできてしまえば簡単なのかなぁ？）~
高くね？てかそもそも方位なんて使うのか？使い道はあるけど「必要」かどうかはまだわからん~
~
あとは書き込み用のSWD端子、サーボ用入力ピン・出力ピン（６〜８本あれば十分かね）、I2C、UART、まあ予備ピン１０本を出しておけば足りるでしょう~
3.3Vのレギュレータ、表面実ＬＥＤ２つ位とボタンも１つ位つけとくか~
基板は安いから中国メーカーに頼みたいけど、時間がかかるからあんまりゆっくり考えてられないよ~
１枚６０００円ってとこかなぁ　まぁ全部載せのハイパースペックだから妥当な値段だとは思うよ~
~

-あとなんか欲しい機能、ある？

-ジャイロ・加速度センサ------LSM330DL(\1250)
STMicroの６軸MPU~
ジャイロが８００Ｈｚ、加速度が１．３Ｋｈｚで動かせます~
温度計も付いてる~
25枚で￥７３９ていうのも魅力~
7月９日、これを買ってポリウレタン線で配線してテストボード化してます

**STM32について　ごえ編 [#ae1388ac]
- 飛行ロボコンの2012年からの新ルール、自動操縦用のマイコンとしてロボ研さんより伝来~
2012年の自動操縦はほとんどロボ研の門倉さんが作ってくれました~
~
*** STMicro社の32bit,ARMマイコン「ＳＴＭ３２」 [#cc35db71]
- 2012年はストロベリーリナックスより販売されている「STbee mini」を使った~
チップはSTM32F103CBT6 (72MHz FLASH128K SRAM20K)~
USBが乗ってて直接書き込みができる~
「マイコン徹底入門」からすぐ使える環境が手に入る（要するに導入が楽~

- 2013年はランクアップしてSTM32F4を使いたい！~
STM32F407VGT6 (168MHz FLASH1M SRAM192K) →STbeeの二倍速い　AVRの１０倍~
浮動小数点も使える~
~
だけど・・・開発環境（ソフトウェア）を自分で作らないといけない（6/12現在）~
今はeclipse + sourcery codebench +　Zylin Embedded CDT　+ openOCD で作ってます~
http://www51.atwiki.jp/kougyou_kei/pages/15.html　参照ページ~
(6/12)コンパイルは通った　openOCDの使い方が分からん動きが怪しい~
ST-linkは認識されて通信ランプが点いてる~
ごえはロボ研の開発環境をもらいました　とりあえずこっちで頑張る（６月２３日)~
~
**８bitマイコン　AVRシリーズ ごえ編[#ae1388ac]
- 入手も簡単　環境も無料 とっても使いやすいマイコン~
- ISP(In System Programming?)の書き込み器さえあればすぐにでも使える~
- ATMEGA328P (8-20MHz FLASH32K SRAM2K EEPROM2K)~
安いし小さいし入手楽だし　→ロケット積載にはもってこい~
- 自動操縦も作れるだろうけど、32bitと比べると見劣りするなぁ~
- Arduinoという簡単な言語で動くマイコンボードにすることも可能~
ただし機能に制限が出るので、利点はない？~

**とりけんマイコンボード　Skipper 仕様 [#ae1388ac]
- マイコン(MCU)  STM32F407VGT6 （STmicroelectronics社~
ARM Cortex-M4プロセッサの32bitマイコン~
168MHzで駆動しDMA(Direct Memory Access)機能を持つ~
~
- 6Dof(six degree of freedom)センサ　LSM330DL  STmicroelectronics社~
1チップに各軸16bit分解能の3軸ジャイロ、加速度をもつ~
内蔵温度計による補正が内部で行われている~
~
- その他機能　SWD書き込み端子~
microSDスロット（ログ記録用）~
UART端子（デバッグ通信用）~
サーボ入力・出力用端子~
赤色LED~
3.3V低損失レギュレータ~

- Skipperの特徴~
基板から自作したことで必要最低限の機能だけを残して両面実装にすることで軽量小型（6.0g)に仕上げることができた。~
組み込みマイコンとしては最高性能であるCortex-M4プロセッサが~
~
- 制御の流れ~
3軸加速度センサから重力加速度方向を測定し、３軸ジャイロによって補正して機体の姿勢を推定する。~
目標姿勢に対してPID制御を行う。~
機体のピッチ角を積分して高度を制御する。

写真は下に
**2014年　SkipperRT かんたんなかいせつ [#ae1388ac]~ [#w6a411f0]
mbedというARM開発環境をeclipseに移植して使うよ~
mbed導入の利点~
- 開発環境構築が簡単で、だれにでも配布できる~
- ライブラリが豊富で、他社用ライブラリとの互換性も高い~
- リアルタイムOS導入がとても簡単~
欠点はcでなくc++であること、ちょっと処理が重くなること~
~
ver1.0ではフライトログの計測と操縦アルゴリズムの検証を目的としてるよ~
- はんだ付けの簡素化のため6軸センサをモジュールのMPU6050に変更~
- パターンの間隔とか余裕を持たせるため大型化~
- LEDを１個から２個に、ボタンを２個つけた　（ＬＥＤがなぜか点灯しない）~
回路図を下に置いておきます~
~
操縦アルゴリズムの洗練~
オリエンテーションフィルタ、クォータニオン、カルマンフィルタ、RTOS等々~
~
これらが完成して余裕があったらデモフライト機作って遊ぶよ~

http://hoistthesails.seesaa.net/←ブログ作って自動操縦関係のこと書いていきます
